<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <canvas width="320" height="640"></canvas>
</body>
<script>
  const tetrominos = {
    'I': [
      [0,0,0,0],
      [1,1,1,1],
      [0,0,0,0],
      [0,0,0,0]
    ],
    'J': [
      [1,0,0],
      [1,1,1],
      [0,0,0],
    ],
    'L': [
      [0,0,1],
      [1,1,1],
      [0,0,0],
    ],
    'O': [
      [1,1],
      [1,1],
    ],
    'S': [
      [0,1,1],
      [1,1,0],
      [0,0,0],
    ],
    'Z': [
      [1,1,0],
      [0,1,1],
      [0,0,0],
    ],
    'T': [
      [0,1,0],
      [1,1,1],
      [0,0,0],
    ]
  };
  let playfield=[];
  const colors = {
    'I': 'cyan',
    'O': 'yellow',
    'T': 'purple',
    'S': 'green',
    'Z': 'red',
    'J': 'blue',
    'L': 'orange'
  };
  let tetrominoSequence=[];
  for(let row=-2;row<20;row++){
    playfield[row]=[];
    for(let col=0;col<10;col++){
      playfield[row][col]=0;
    }
  }
  let tetromino=getNextTetromino();
  function isValidMove(matrix, cellRow, cellCol){
    for (let row =0;row<matrix.length;row++){
      for(let col=0;col<matrix[row].length;col++){
        if( matrix[row][col]&&(
          cellCol+col<0||
          cellCol+col>=playfield[0].length||
          cellRow+row>=playfield.length||
          //choque con otras piezas
          playfield[cellRow+row][cellCol+col]
        )){
          return false;
        }
      }
    }
    return false;
  }
  function getRandomInt(min,max){
    min=Math.ceil(min);
    max=Math.ceil(max);
    return Math.floor(Math.random()*(max-min+1)+min)
  }
  function generateSequence(){
    const sequence=['I','J','L','O','S','T','Z'];
    while (sequence.length){
      const rand=getRandomInt(0,sequence.length-1)
      const name=sequence.splice(rand,1)[0]
      tetrominoSequence.push(name);
    }
  }
  function getNextTetromino(){
    if(tetrominoSequence.length===0){
      generateSequence();
    };
    const name=tetrominoSequence.pop();
    const matrix=tetrominos[name];
    const col=playfield[0].length/2-Math.ceil(matrix[0].length/2);
    const row =name==='I'?-1:-2;
    return {name, matrix, row, col}
  }
  document.addEventListener('keydown', function(e){
    if(e.which===65||e.which===68){
      const col= e.which===65?tetromino.col-1:tetromino.col+1;
      if(isValidMove(tetromino.matrix,tetromino.row,col)){
        tetromino.atrix=matrix;
      }
    }
  })
</script>
</html>